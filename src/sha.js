/*
 A JavaScript implementation of the SHA family of hashes, as
 defined in FIPS PUB 180-2 as well as the corresponding HMAC implementation
 as defined in FIPS PUB 198a

 Copyright Brian Turek 2008-2015
 Distributed under the BSD License
 See http://caligatio.github.com/jsSHA/ for more information

 Several functions taken from Paul Johnston
*/
'use strict';(function(V){function w(b,a,d){var c=0,f=[],g=0,h,e,p,k,l,r,z,q=!1,t=[],u=[],m,v=!1;d=d||{};h=d.encoding||"UTF8";m=d.numRounds||1;p=L(a,h);if(m!==parseInt(m,10)||1>m)throw Error("numRounds must a integer >= 1");if("SHA-1"===b)l=512,r=M,z=W,k=160;else if(r=function(a,d){return N(a,d,b)},z=function(a,d,c,f){var g;a=a.slice();var n=f.slice();if("SHA-224"===b||"SHA-256"===b)g=(d+65>>>9<<4)+15,f=16;else if("SHA-384"===b||"SHA-512"===b)g=(d+129>>>10<<5)+31,f=32;else throw Error("Unexpected error in SHA-2 implementation");
for(;a.length<=g;)a.push(0);a[d>>>5]|=128<<24-d%32;a[g]=d+c;c=a.length;for(d=0;d<c;d+=f)n=N(a.slice(d,d+f),n,b);if("SHA-224"===b)a=[n[0],n[1],n[2],n[3],n[4],n[5],n[6]];else if("SHA-256"===b)a=n;else if("SHA-384"===b)a=[n[0].a,n[0].b,n[1].a,n[1].b,n[2].a,n[2].b,n[3].a,n[3].b,n[4].a,n[4].b,n[5].a,n[5].b];else if("SHA-512"===b)a=[n[0].a,n[0].b,n[1].a,n[1].b,n[2].a,n[2].b,n[3].a,n[3].b,n[4].a,n[4].b,n[5].a,n[5].b,n[6].a,n[6].b,n[7].a,n[7].b];else throw Error("Unexpected error in SHA-2 implementation");
return a},"SHA-224"===b)l=512,k=224;else if("SHA-256"===b)l=512,k=256;else if("SHA-384"===b)l=1024,k=384;else if("SHA-512"===b)l=1024,k=512;else throw Error("Chosen SHA variant is not supported");e=y(b);this.setHMACKey=function(a,d,f){var g;if(!0===q)throw Error("HMAC key already set");if(!0===v)throw Error("Cannot set HMAC key after calling update");h=(f||{}).encoding||"UTF8";d=L(d,h)(a);a=d.binLen;d=d.value;g=l>>>3;f=g/4-1;if(g<a/8){for(d=z(d,a,0,y(b));d.length<=f;)d.push(0);d[f]&=4294967040}else if(g>
a/8){for(;d.length<=f;)d.push(0);d[f]&=4294967040}for(a=0;a<=f;a+=1)t[a]=d[a]^909522486,u[a]=d[a]^1549556828;e=r(t,e);c=l;q=!0};this.update=function(a){var b,d,h,k=0,q=l>>>5;b=p(a,f,g);a=b.binLen;d=b.value;b=a>>>5;for(h=0;h<b;h+=q)k+l<=a&&(e=r(d.slice(h,h+q),e),k+=l);c+=k;f=d.slice(k>>>5);g=a%l;v=!0};this.getHash=function(a,d){var h,l,p,r;if(!0===q)throw Error("Cannot call getHash after setting HMAC key");p=O(d);switch(a){case "HEX":h=function(a){return P(a,p)};break;case "B64":h=function(a){return Q(a,
p)};break;case "BYTES":h=R;break;default:throw Error("format must be HEX, B64, or BYTES");}r=z(f,g,c,e);for(l=1;l<m;l+=1)r=z(r,k,0,y(b));return h(r)};this.getHMAC=function(a,d){var h,p,m,t;if(!1===q)throw Error("Cannot call getHMAC without first setting HMAC key");m=O(d);switch(a){case "HEX":h=function(a){return P(a,m)};break;case "B64":h=function(a){return Q(a,m)};break;case "BYTES":h=R;break;default:throw Error("outputFormat must be HEX, B64, or BYTES");}p=z(f,g,c,e);t=r(u,y(b));t=z(p,k,l,t);return h(t)}}
function c(b,a){this.a=b;this.b=a}function X(b,a,d){var c=b.length,f,g,h,e,p;a=a||[0];d=d||0;p=d>>>3;if(0!==c%2)throw Error("String of HEX type must be in byte increments");for(f=0;f<c;f+=2){g=parseInt(b.substr(f,2),16);if(isNaN(g))throw Error("String of HEX type contains invalid characters");e=(f>>>1)+p;for(h=e>>>2;a.length<=h;)a.push(0);a[h]|=g<<8*(3-e%4)}return{value:a,binLen:4*c+d}}function Y(b,a,d){var c=[],f,g,h,e,c=a||[0];d=d||0;g=d>>>3;for(f=0;f<b.length;f+=1)a=b.charCodeAt(f),e=f+g,h=e>>>
2,c.length<=h&&c.push(0),c[h]|=a<<8*(3-e%4);return{value:c,binLen:8*b.length+d}}function Z(b,a,d){var c=[],f=0,g,h,e,p,k,l,c=a||[0];d=d||0;a=d>>>3;if(-1===b.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");h=b.indexOf("=");b=b.replace(/\=/g,"");if(-1!==h&&h<b.length)throw Error("Invalid '=' found in base-64 string");for(h=0;h<b.length;h+=4){k=b.substr(h,4);for(e=p=0;e<k.length;e+=1)g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(k[e]),p|=
g<<18-6*e;for(e=0;e<k.length-1;e+=1){l=f+a;for(g=l>>>2;c.length<=g;)c.push(0);c[g]|=(p>>>16-8*e&255)<<8*(3-l%4);f+=1}}return{value:c,binLen:8*f+d}}function P(b,a){var d="",c=4*b.length,f,g;for(f=0;f<c;f+=1)g=b[f>>>2]>>>8*(3-f%4),d+="0123456789abcdef".charAt(g>>>4&15)+"0123456789abcdef".charAt(g&15);return a.outputUpper?d.toUpperCase():d}function Q(b,a){var d="",c=4*b.length,f,g,e;for(f=0;f<c;f+=3)for(e=f+1>>>2,g=b.length<=e?0:b[e],e=f+2>>>2,e=b.length<=e?0:b[e],e=(b[f>>>2]>>>8*(3-f%4)&255)<<16|(g>>>
8*(3-(f+1)%4)&255)<<8|e>>>8*(3-(f+2)%4)&255,g=0;4>g;g+=1)8*f+6*g<=32*b.length?d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6*(3-g)&63):d+=a.b64Pad;return d}function R(b){var a="",d=4*b.length,c,f;for(c=0;c<d;c+=1)f=b[c>>>2]>>>8*(3-c%4)&255,a+=String.fromCharCode(f);return a}function O(b){var a={outputUpper:!1,b64Pad:"="};b=b||{};a.outputUpper=b.outputUpper||!1;!0===b.hasOwnProperty("b64Pad")&&(a.b64Pad=b.b64Pad);if("boolean"!==typeof a.outputUpper)throw Error("Invalid outputUpper formatting option");
if("string"!==typeof a.b64Pad)throw Error("Invalid b64Pad formatting option");return a}function L(b,a){var d;switch(a){case "UTF8":case "UTF16BE":case "UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE");}switch(b){case "HEX":d=X;break;case "TEXT":d=function(b,d,c){var e=[],x=[],p=0,k,l,r,m,q,e=d||[0];d=c||0;r=d>>>3;if("UTF8"===a)for(k=0;k<b.length;k+=1)for(c=b.charCodeAt(k),x=[],128>c?x.push(c):2048>c?(x.push(192|c>>>6),x.push(128|c&63)):55296>c||57344<=c?x.push(224|
c>>>12,128|c>>>6&63,128|c&63):(k+=1,c=65536+((c&1023)<<10|b.charCodeAt(k)&1023),x.push(240|c>>>18,128|c>>>12&63,128|c>>>6&63,128|c&63)),l=0;l<x.length;l+=1){q=p+r;for(m=q>>>2;e.length<=m;)e.push(0);e[m]|=x[l]<<8*(3-q%4);p+=1}else if("UTF16BE"===a||"UTF16LE"===a)for(k=0;k<b.length;k+=1){c=b.charCodeAt(k);"UTF16LE"===a&&(l=c&255,c=l<<8|c>>>8);q=p+r;for(m=q>>>2;e.length<=m;)e.push(0);e[m]|=c<<8*(2-q%4);p+=2}return{value:e,binLen:8*p+d}};break;case "B64":d=Z;break;case "BYTES":d=Y;break;default:throw Error("format must be HEX, TEXT, B64, or BYTES");
}return d}function v(b,a){return b<<a|b>>>32-a}function t(b,a){return b>>>a|b<<32-a}function m(b,a){var d=null,d=new c(b.a,b.b);return d=32>=a?new c(d.a>>>a|d.b<<32-a&4294967295,d.b>>>a|d.a<<32-a&4294967295):new c(d.b>>>a-32|d.a<<64-a&4294967295,d.a>>>a-32|d.b<<64-a&4294967295)}function S(b,a){var d=null;return d=32>=a?new c(b.a>>>a,b.b>>>a|b.a<<32-a&4294967295):new c(0,b.a>>>a-32)}function aa(b,a,d){return b&a^~b&d}function ba(b,a,d){return new c(b.a&a.a^~b.a&d.a,b.b&a.b^~b.b&d.b)}function T(b,a,
d){return b&a^b&d^a&d}function ca(b,a,d){return new c(b.a&a.a^b.a&d.a^a.a&d.a,b.b&a.b^b.b&d.b^a.b&d.b)}function da(b){return t(b,2)^t(b,13)^t(b,22)}function ea(b){var a=m(b,28),d=m(b,34);b=m(b,39);return new c(a.a^d.a^b.a,a.b^d.b^b.b)}function fa(b){return t(b,6)^t(b,11)^t(b,25)}function ga(b){var a=m(b,14),d=m(b,18);b=m(b,41);return new c(a.a^d.a^b.a,a.b^d.b^b.b)}function ha(b){return t(b,7)^t(b,18)^b>>>3}function ia(b){var a=m(b,1),d=m(b,8);b=S(b,7);return new c(a.a^d.a^b.a,a.b^d.b^b.b)}function ja(b){return t(b,
17)^t(b,19)^b>>>10}function ka(b){var a=m(b,19),d=m(b,61);b=S(b,6);return new c(a.a^d.a^b.a,a.b^d.b^b.b)}function B(b,a){var d=(b&65535)+(a&65535);return((b>>>16)+(a>>>16)+(d>>>16)&65535)<<16|d&65535}function la(b,a,d,c){var e=(b&65535)+(a&65535)+(d&65535)+(c&65535);return((b>>>16)+(a>>>16)+(d>>>16)+(c>>>16)+(e>>>16)&65535)<<16|e&65535}function C(b,a,d,c,e){var g=(b&65535)+(a&65535)+(d&65535)+(c&65535)+(e&65535);return((b>>>16)+(a>>>16)+(d>>>16)+(c>>>16)+(e>>>16)+(g>>>16)&65535)<<16|g&65535}function ma(b,
a){var d,e,f;d=(b.b&65535)+(a.b&65535);e=(b.b>>>16)+(a.b>>>16)+(d>>>16);f=(e&65535)<<16|d&65535;d=(b.a&65535)+(a.a&65535)+(e>>>16);e=(b.a>>>16)+(a.a>>>16)+(d>>>16);return new c((e&65535)<<16|d&65535,f)}function na(b,a,d,e){var f,g,h;f=(b.b&65535)+(a.b&65535)+(d.b&65535)+(e.b&65535);g=(b.b>>>16)+(a.b>>>16)+(d.b>>>16)+(e.b>>>16)+(f>>>16);h=(g&65535)<<16|f&65535;f=(b.a&65535)+(a.a&65535)+(d.a&65535)+(e.a&65535)+(g>>>16);g=(b.a>>>16)+(a.a>>>16)+(d.a>>>16)+(e.a>>>16)+(f>>>16);return new c((g&65535)<<16|
f&65535,h)}function oa(b,a,d,e,f){var g,h,m;g=(b.b&65535)+(a.b&65535)+(d.b&65535)+(e.b&65535)+(f.b&65535);h=(b.b>>>16)+(a.b>>>16)+(d.b>>>16)+(e.b>>>16)+(f.b>>>16)+(g>>>16);m=(h&65535)<<16|g&65535;g=(b.a&65535)+(a.a&65535)+(d.a&65535)+(e.a&65535)+(f.a&65535)+(h>>>16);h=(b.a>>>16)+(a.a>>>16)+(d.a>>>16)+(e.a>>>16)+(f.a>>>16)+(g>>>16);return new c((h&65535)<<16|g&65535,m)}function y(b){var a,d;if("SHA-1"===b)b=[1732584193,4023233417,2562383102,271733878,3285377520];else switch(a=[3238371032,914150663,
812702999,4144912697,4290775857,1750603025,1694076839,3204075428],d=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],b){case "SHA-224":b=a;break;case "SHA-256":b=d;break;case "SHA-384":b=[new c(3418070365,a[0]),new c(1654270250,a[1]),new c(2438529370,a[2]),new c(355462360,a[3]),new c(1731405415,a[4]),new c(41048885895,a[5]),new c(3675008525,a[6]),new c(1203062813,a[7])];break;case "SHA-512":b=[new c(d[0],4089235720),new c(d[1],2227873595),new c(d[2],4271175723),
new c(d[3],1595750129),new c(d[4],2917565137),new c(d[5],725511199),new c(d[6],4215389547),new c(d[7],327033209)];break;default:throw Error("Unknown SHA variant");}return b}function M(b,a){var d=[],c,e,g,h,m,p,k,l=a.slice();c=l[0];e=l[1];g=l[2];h=l[3];m=l[4];for(k=0;80>k;k+=1)d[k]=16>k?b[k]:v(d[k-3]^d[k-8]^d[k-14]^d[k-16],1),p=20>k?C(v(c,5),e&g^~e&h,m,1518500249,d[k]):40>k?C(v(c,5),e^g^h,m,1859775393,d[k]):60>k?C(v(c,5),T(e,g,h),m,2400959708,d[k]):C(v(c,5),e^g^h,m,3395469782,d[k]),m=h,h=g,g=v(e,30),
e=c,c=p;l[0]=B(c,l[0]);l[1]=B(e,l[1]);l[2]=B(g,l[2]);l[3]=B(h,l[3]);l[4]=B(m,l[4]);return l}function W(b,a,c,e){var f;b=b.slice();e=e.slice();for(f=(a+65>>>9<<4)+15;b.length<=f;)b.push(0);b[a>>>5]|=128<<24-a%32;b[f]=a+c;c=b.length;for(a=0;a<c;a+=16)e=M(b.slice(a,a+16),e);return e}function N(b,a,d){var n,f,g,h,m,p,k,l,r,t,q,v,u,w,y,D,E,F,G,H,I,J,A=[],K;a=a.slice();if("SHA-224"===d||"SHA-256"===d)t=64,v=1,J=Number,u=B,w=la,y=C,D=ha,E=ja,F=da,G=fa,I=T,H=aa,K=e;else if("SHA-384"===d||"SHA-512"===d)t=
80,v=2,J=c,u=ma,w=na,y=oa,D=ia,E=ka,F=ea,G=ga,I=ca,H=ba,K=U;else throw Error("Unexpected error in SHA-2 implementation");d=a[0];n=a[1];f=a[2];g=a[3];h=a[4];m=a[5];p=a[6];k=a[7];for(q=0;q<t;q+=1)16>q?(r=q*v,l=b.length<=r?0:b[r],r=b.length<=r+1?0:b[r+1],A[q]=new J(l,r)):A[q]=w(E(A[q-2]),A[q-7],D(A[q-15]),A[q-16]),l=y(k,G(h),H(h,m,p),K[q],A[q]),r=u(F(d),I(d,n,f)),k=p,p=m,m=h,h=u(g,l),g=f,f=n,n=d,d=u(l,r);a[0]=u(d,a[0]);a[1]=u(n,a[1]);a[2]=u(f,a[2]);a[3]=u(g,a[3]);a[4]=u(h,a[4]);a[5]=u(m,a[5]);a[6]=u(p,
a[6]);a[7]=u(k,a[7]);return a}var e,U;e=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,
3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];U=[new c(e[0],3609767458),new c(e[1],602891725),new c(e[2],3964484399),new c(e[3],2173295548),new c(e[4],4081628472),new c(e[5],3053834265),new c(e[6],2937671579),new c(e[7],3664609560),new c(e[8],2734883394),new c(e[9],1164996542),new c(e[10],1323610764),new c(e[11],3590304994),
new c(e[12],4068182383),new c(e[13],991336113),new c(e[14],633803317),new c(e[15],3479774868),new c(e[16],2666613458),new c(e[17],944711139),new c(e[18],2341262773),new c(e[19],2007800933),new c(e[20],1495990901),new c(e[21],1856431235),new c(e[22],3175218132),new c(e[23],2198950837),new c(e[24],3999719339),new c(e[25],766784016),new c(e[26],2566594879),new c(e[27],3203337956),new c(e[28],1034457026),new c(e[29],2466948901),new c(e[30],3758326383),new c(e[31],168717936),new c(e[32],1188179964),new c(e[33],
1546045734),new c(e[34],1522805485),new c(e[35],2643833823),new c(e[36],2343527390),new c(e[37],1014477480),new c(e[38],1206759142),new c(e[39],344077627),new c(e[40],1290863460),new c(e[41],3158454273),new c(e[42],3505952657),new c(e[43],106217008),new c(e[44],3606008344),new c(e[45],1432725776),new c(e[46],1467031594),new c(e[47],851169720),new c(e[48],3100823752),new c(e[49],1363258195),new c(e[50],3750685593),new c(e[51],3785050280),new c(e[52],3318307427),new c(e[53],3812723403),new c(e[54],
2003034995),new c(e[55],3602036899),new c(e[56],1575990012),new c(e[57],1125592928),new c(e[58],2716904306),new c(e[59],442776044),new c(e[60],593698344),new c(e[61],3733110249),new c(e[62],2999351573),new c(e[63],3815920427),new c(3391569614,3928383900),new c(3515267271,566280711),new c(3940187606,3454069534),new c(4118630271,4000239992),new c(116418474,1914138554),new c(174292421,2731055270),new c(289380356,3203993006),new c(460393269,320620315),new c(685471733,587496836),new c(852142971,1086792851),
new c(1017036298,365543100),new c(1126000580,2618297676),new c(1288033470,3409855158),new c(1501505948,4234509866),new c(1607167915,987167468),new c(1816402316,1246189591)];"function"===typeof define&&define.amd?define(function(){return w}):"undefined"!==typeof exports?"undefined"!==typeof module&&module.exports?module.exports=exports=w:exports=w:V.jsSHA=w})(this);
