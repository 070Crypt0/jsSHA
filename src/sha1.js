(function(module) {/*
 A JavaScript implementation of the SHA family of hashes, as defined in FIPS
 PUB 180-2 as well as the corresponding HMAC implementation as defined in
 FIPS PUB 198a

 Copyright Brian Turek 2008-2013
 Distributed under the BSD License
 See http://caligatio.github.com/jsSHA/ for more information

 Several functions taken from Paul Johnston
*/
(function(C){function u(a,d){var b=[],f,e=[],c=0,g;if("UTF8"===d)for(g=0;g<a.length;g+=1)for(f=a.charCodeAt(g),e=[],2048<f?(e[0]=224|(f&61440)>>>12,e[1]=128|(f&4032)>>>6,e[2]=128|f&63):128<f?(e[0]=192|(f&1984)>>>6,e[1]=128|f&63):e[0]=f,f=0;f<e.length;f+=1)b[c>>>2]|=e[f]<<24-c%4*8,c+=1;else if("UTF16"===d)for(g=0;g<a.length;g+=1)b[c>>>2]|=a.charCodeAt(g)<<16-c%4*8,c+=2;return{value:b,binLen:8*c}}function v(a){var d=[],b=a.length,f,e;if(0!==b%2)throw"String of HEX type must be in byte increments";for(f=
0;f<b;f+=2){e=parseInt(a.substr(f,2),16);if(isNaN(e))throw"String of HEX type contains invalid characters";d[f>>>3]|=e<<24-f%8*4}return{value:d,binLen:4*b}}function w(a){var d=[],b=0,f,e,c,g,p;if(-1===a.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";f=a.indexOf("=");a=a.replace(/\=/g,"");if(-1!==f&&f<a.length)throw"Invalid '=' found in base-64 string";for(e=0;e<a.length;e+=4){p=a.substr(e,4);for(c=g=0;c<p.length;c+=1)f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(p[c]),
g|=f<<18-6*c;for(c=0;c<p.length-1;c+=1)d[b>>2]|=(g>>>16-8*c&255)<<24-b%4*8,b+=1}return{value:d,binLen:8*b}}function x(a,d){var b="",f=4*a.length,e,c;for(e=0;e<f;e+=1)c=a[e>>>2]>>>8*(3-e%4),b+="0123456789abcdef".charAt(c>>>4&15)+"0123456789abcdef".charAt(c&15);return d.outputUpper?b.toUpperCase():b}function y(a,d){var b="",f=4*a.length,e,c,g;for(e=0;e<f;e+=3)for(g=(a[e>>>2]>>>8*(3-e%4)&255)<<16|(a[e+1>>>2]>>>8*(3-(e+1)%4)&255)<<8|a[e+2>>>2]>>>8*(3-(e+2)%4)&255,c=0;4>c;c+=1)b=8*e+6*c<=32*a.length?b+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>>6*(3-c)&63):b+d.b64Pad;return b}function z(a){var d={outputUpper:!1,b64Pad:"="};try{a.hasOwnProperty("outputUpper")&&(d.outputUpper=a.outputUpper),a.hasOwnProperty("b64Pad")&&(d.b64Pad=a.b64Pad)}catch(b){}if("boolean"!==typeof d.outputUpper)throw"Invalid outputUpper formatting option";if("string"!==typeof d.b64Pad)throw"Invalid b64Pad formatting option";return d}function D(a,d){return a<<d|a>>>32-d}function E(a,d,b){return a^
d^b}function F(a,d,b){return a&d^~a&b}function G(a,d,b){return a&d^a&b^d&b}function H(a,d){var b=(a&65535)+(d&65535);return((a>>>16)+(d>>>16)+(b>>>16)&65535)<<16|b&65535}function I(a,d,b,f,e){var c=(a&65535)+(d&65535)+(b&65535)+(f&65535)+(e&65535);return((a>>>16)+(d>>>16)+(b>>>16)+(f>>>16)+(e>>>16)+(c>>>16)&65535)<<16|c&65535}function q(a,d){var b=[],f,e,c,g,p,A,J=F,B=E,t=G,h=D,l=H,m,k,r=I,s,n=[1732584193,4023233417,2562383102,271733878,3285377520],q=[1518500249,1518500249,1518500249,1518500249,1518500249,
1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,
2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782];a[d>>>5]|=128<<24-d%32;a[(d+65>>>9<<4)+15]=d;s=a.length;for(m=0;m<s;m+=16){f=n[0];e=n[1];c=n[2];g=n[3];p=n[4];for(k=0;80>k;k+=1)b[k]=16>k?a[k+m]:h(b[k-3]^b[k-8]^b[k-14]^b[k-16],1),A=
20>k?r(h(f,5),J(e,c,g),p,q[k],b[k]):40>k?r(h(f,5),B(e,c,g),p,q[k],b[k]):60>k?r(h(f,5),t(e,c,g),p,q[k],b[k]):r(h(f,5),B(e,c,g),p,q[k],b[k]),p=g,g=c,c=h(e,30),e=f,f=A;n[0]=l(f,n[0]);n[1]=l(e,n[1]);n[2]=l(c,n[2]);n[3]=l(g,n[3]);n[4]=l(p,n[4])}return n}C.jsSHA=function(a,d,b){var f=0,e=[0],c="",g=null,c=b||"UTF8";if("UTF8"!==c&&"UTF16"!==c)throw"encoding must be UTF8 or UTF16";if("HEX"===d){if(0!==a.length%2)throw"srcString of HEX type must be in byte increments";g=v(a);f=g.binLen;e=g.value}else if("ASCII"===
d||"TEXT"===d)g=u(a,c),f=g.binLen,e=g.value;else if("B64"===d)g=w(a),f=g.binLen,e=g.value;else throw"inputFormat must be HEX, TEXT, ASCII, or B64";this.getHash=function(a,b,c,d){var g=null,h=e.slice(),l=f,m;3===arguments.length?"number"!==typeof c&&(d=c,c=1):2===arguments.length&&(c=1);switch(b){case "HEX":g=x;break;case "B64":g=y;break;default:throw"format must be HEX or B64";}if("SHA-1"===a)for(m=0;m<c;m++)h=q(h,l),l=160;else throw"Chosen SHA variant is not supported";return g(h,z(d))};this.getHMAC=
function(a,b,d,g,t){var h,l,m,k,r=[],s=[];h=null;switch(g){case "HEX":g=x;break;case "B64":g=y;break;default:throw"outputFormat must be HEX or B64";}if("SHA-1"===d)l=64,k=160;else throw"Chosen SHA variant is not supported";if("HEX"===b)h=v(a),m=h.binLen,h=h.value;else if("ASCII"===b||"TEXT"===b)h=u(a,c),m=h.binLen,h=h.value;else if("B64"===b)h=w(a),m=h.binLen,h=h.value;else throw"inputFormat must be HEX, TEXT, ASCII, or B64";a=8*l;b=l/4-1;if(l<m/8){if("SHA-1"===d)h=q(h,m);else throw"Unexpected error in HMAC implementation";
h[b]&=4294967040}else l>m/8&&(h[b]&=4294967040);for(l=0;l<=b;l+=1)r[l]=h[l]^909522486,s[l]=h[l]^1549556828;if("SHA-1"===d)d=q(s.concat(q(r.concat(e),a+f)),a+k);else throw"Unexpected error in HMAC implementation";return g(d,z(t))}}})(this);})(this);
